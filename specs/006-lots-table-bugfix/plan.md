# Implementation Plan: Lots Table & Bugfixes

**Branch**: `006-lots-table-bugfix` | **Date**: 2026-02-11 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/006-lots-table-bugfix/spec.md`

## Summary

Fix event selection OOB bug (nested OOB overwrites lots), fetch full lot data for display, replace card layout with editable table showing all lot fields with override highlighting and per-row save.

## Technical Context

**Language/Version**: Python 3.14, Django 5
**Primary Dependencies**: HTMX 2.0.4 (CDN), ABConnectTools 0.2.1 (editable install)
**Storage**: SQLite3 (sessions only — no new storage)
**Testing**: pytest + pytest-django
**Target Platform**: Linux server (gunicorn behind nginx)
**Project Type**: Web application (server-rendered with HTMX)
**Performance Goals**: Lots table page load acceptable at 25 lots (26 API calls)
**Constraints**: No batch lot endpoint available — individual `get_lot()` calls required
**Scale/Scope**: Single operator tool, ~50 concurrent users max

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Artifact Harmony | PASS | Spec, contracts, tests, and code updated together |
| II. Executable Knowledge | PASS | Contract tests for all new endpoints and bug fixes |
| III. Contracted Boundaries | PASS | Endpoint contracts defined in contracts/endpoints.md |
| IV. Versioned Traceability | PASS | Feature branch with reviewable changesets |
| V. Communicable Truth | PASS | quickstart.md updated with verification steps |

**Post-design re-check**: PASS — no violations introduced.

## Project Structure

### Documentation (this feature)

```text
specs/006-lots-table-bugfix/
├── plan.md
├── spec.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   └── endpoints.md
└── tasks.md              # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
src/
├── catalog/
│   ├── services.py                              # get_lot (existing), get_lots_for_event (new)
│   ├── urls.py                                  # Add /panels/lots/{id}/override/ route
│   ├── views/
│   │   ├── panels.py                            # Modify event_lots_panel, add lot_override_panel
│   │   └── sellers.py                           # Modify hydration path
│   ├── templates/catalog/partials/
│   │   ├── events_panel.html                    # Add skip_main_oob guard
│   │   ├── lots_panel.html                      # Replace cards with table include
│   │   ├── lots_table.html                      # New: table layout template
│   │   └── lots_table_row.html                  # New: single row partial (for OOB row update)
│   └── static/catalog/
│       └── styles.css                           # Table styles, .overridden class

tests/
└── contract/
    └── test_panels.py                           # Update lots panel tests, add override tests
```

**Structure Decision**: Existing single-project Django layout. New templates for table layout; new panel endpoint for per-row save.

## Complexity Tracking

No constitution violations — no entries needed.
