# Implementation Plan: Catalog Dropzone

**Branch**: `002-catalog-dropzone` | **Date**: 2026-02-10 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/002-catalog-dropzone/spec.md`

## Summary

Add a drag-and-drop "Add Catalog" zone to the navigation bar that accepts catalog spreadsheet files (.xlsx, .csv, .json). Files are parsed using the existing `load_file()` importer and sent to the bulk insert API. On success, the user is redirected to the created event page. On failure, a client-side toast displays the error. The feature reuses the entire existing import pipeline, adding only the upload view, navbar UI, and toast system.

## Technical Context

**Language/Version**: Python 3.14, Django 5
**Primary Dependencies**: Django 5, HTMX 2.0.4 (CDN), ABConnectTools 0.2.1 (editable install)
**Storage**: SQLite3 (sessions only); file uploads are in-memory/tempfile, not persisted
**Testing**: pytest
**Target Platform**: Linux server, web browser
**Project Type**: Web application (Django monolith)
**Performance Goals**: File upload + parse + API insert completes within existing import timeframe; toast appears within 3s on error
**Constraints**: No new JS dependencies; no new Python dependencies
**Scale/Scope**: Single new endpoint, modifications to 4 existing files, ~150 lines of new code

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Artifact Harmony | PASS | Spec, contracts, data-model, quickstart, and tests all included in plan |
| II. Executable Knowledge | PASS | Test plan covers contract tests for the endpoint and integration tests for the upload flow |
| III. Contracted Boundaries | PASS | API contract defined in `contracts/api.yaml` before implementation |
| IV. Versioned Traceability | PASS | Feature branch `002-catalog-dropzone` with spec-driven commits |
| V. Communicable Truth | PASS | quickstart.md documents how to test manually and programmatically |

**Post-Phase 1 Re-check**: All pass. No new data models, no new dependencies, no architectural changes. The feature is additive and contained.

## Project Structure

### Documentation (this feature)

```text
specs/002-catalog-dropzone/
├── plan.md              # This file
├── spec.md              # Feature specification
├── research.md          # Phase 0: technical research findings
├── data-model.md        # Phase 1: request/response shapes
├── quickstart.md        # Phase 1: testing guide
├── contracts/
│   └── api.yaml         # Phase 1: OpenAPI contract for upload endpoint
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/
├── catalog/
│   ├── views/
│   │   └── imports.py           # MODIFIED: add upload_catalog view
│   ├── templates/catalog/
│   │   └── base.html            # MODIFIED: add dropzone to navbar, toast container, JS
│   ├── static/catalog/
│   │   └── styles.css           # MODIFIED: add dropzone and toast CSS
│   ├── services.py              # MODIFIED: add find_catalog_by_customer_id
│   └── urls.py                  # MODIFIED: add imports/upload/ route

tests/
└── test_upload.py               # NEW: upload endpoint tests
```

**Structure Decision**: Extends the existing Django monolith structure from feature 001. No new apps, no new directories. All changes are additions to existing files plus one new test file.

## Complexity Tracking

> No violations. All changes are minimal additions to existing patterns.
